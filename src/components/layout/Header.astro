---
import Button from '../common/Button.astro';

const navItems = [
  { label: 'Projects', href: '/projects' },
  { label: 'Inspiration', href: '/inspiration' },
  { label: 'About', href: '/about' },
  { label: 'Contact', href: '/contact' },
];

const currentPath = Astro.url.pathname;
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-[80] transition-all duration-300"
>
  <div class="container-luxury">
    <nav class="flex items-center justify-between h-20 lg:h-24">
      <!-- Logo -->
      <a href="/" class="relative z-10 flex-shrink-0">
        <img
          src="/images/logo.svg"
          alt="By Shakir Luxury Interiors"
          class="h-10 lg:h-12 w-auto"
        />
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-8">
        {navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              'text-sm tracking-wider uppercase transition-colors duration-300',
              currentPath === item.href || currentPath.startsWith(item.href + '/')
                ? 'text-gold'
                : 'text-cream/80 hover:text-gold'
            ]}
          >
            {item.label}
          </a>
        ))}
      </div>

      <!-- CTA Button & Mobile Menu Toggle -->
      <div class="flex items-center gap-4">
        <div class="hidden lg:block">
          <Button href="/contact" variant="primary" size="sm">
            Get in Touch
          </Button>
        </div>

        <!-- Mobile Menu Toggle -->
        <button
          id="mobile-menu-toggle"
          class="lg:hidden relative z-[90] w-10 h-10 flex flex-col items-center justify-center gap-1.5"
          aria-label="Toggle menu"
          aria-expanded="false"
        >
          <span class="menu-line w-6 h-0.5 bg-cream transition-all duration-300"></span>
          <span class="menu-line w-6 h-0.5 bg-cream transition-all duration-300"></span>
          <span class="menu-line w-6 h-0.5 bg-cream transition-all duration-300"></span>
        </button>
      </div>
    </nav>
  </div>
</header>

<!-- Mobile Menu -->
<div
  id="mobile-menu"
  class="fixed inset-0 z-[70] lg:hidden translate-x-full transition-transform duration-300 ease-out bg-black/65 mobile-menu-overlay"
>
  <div class="flex flex-col items-center justify-center min-h-screen gap-8 p-8">
    {navItems.map((item) => (
      <a
        href={item.href}
        class:list={[
          'text-2xl font-serif tracking-wider transition-colors duration-300',
          currentPath === item.href ? 'text-gold' : 'text-cream hover:text-gold'
        ]}
      >
        {item.label}
      </a>
    ))}
    <div class="mt-8">
      <Button href="/contact" variant="primary" size="md">
        Get in Touch
      </Button>
    </div>
  </div>
</div>

<script>
  const header = document.getElementById('header');
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuLines = mobileMenuToggle?.querySelectorAll('.menu-line');
  let isMenuOpen = false;

  // Header scroll effect
  const handleScroll = () => {
    if (window.scrollY > 50) {
      header?.classList.add('bg-black/90', 'backdrop-blur-md', 'shadow-lg');
    } else {
      header?.classList.remove('bg-black/90', 'backdrop-blur-md', 'shadow-lg');
    }
  };

  window.addEventListener('scroll', handleScroll);
  handleScroll();

  // Mobile menu toggle
  mobileMenuToggle?.addEventListener('click', () => {
    isMenuOpen = !isMenuOpen;
    mobileMenuToggle.setAttribute('aria-expanded', String(isMenuOpen));

    if (isMenuOpen) {
      mobileMenu?.classList.remove('translate-x-full');
      document.body.style.overflow = 'hidden';
      // Animate hamburger to X
      menuLines?.[0]?.classList.add('rotate-45', 'translate-y-2');
      menuLines?.[1]?.classList.add('opacity-0');
      menuLines?.[2]?.classList.add('-rotate-45', '-translate-y-2');
    } else {
      mobileMenu?.classList.add('translate-x-full');
      document.body.style.overflow = '';
      // Reset hamburger
      menuLines?.[0]?.classList.remove('rotate-45', 'translate-y-2');
      menuLines?.[1]?.classList.remove('opacity-0');
      menuLines?.[2]?.classList.remove('-rotate-45', '-translate-y-2');
    }
  });

  // Close menu on link click
  mobileMenu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu.classList.add('translate-x-full');
      document.body.style.overflow = '';
      isMenuOpen = false;
      mobileMenuToggle?.setAttribute('aria-expanded', 'false');
      menuLines?.[0]?.classList.remove('rotate-45', 'translate-y-2');
      menuLines?.[1]?.classList.remove('opacity-0');
      menuLines?.[2]?.classList.remove('-rotate-45', '-translate-y-2');
    });
  });

  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isMenuOpen) {
      mobileMenu?.classList.add('translate-x-full');
      document.body.style.overflow = '';
      isMenuOpen = false;
      mobileMenuToggle?.setAttribute('aria-expanded', 'false');
      menuLines?.[0]?.classList.remove('rotate-45', 'translate-y-2');
      menuLines?.[1]?.classList.remove('opacity-0');
      menuLines?.[2]?.classList.remove('-rotate-45', '-translate-y-2');
    }
  });
</script>
